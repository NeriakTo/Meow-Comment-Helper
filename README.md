# 🐱 喵嗚評語助手 (Meow Comment Helper) V6.1

> **全能行政版 (All-in-One Edition)**
> 專為國小導師打造的學務系統完美對接工具，支援手機、平板、電腦跨裝置操作，隨時隨地都能完成完整的學期評量！

![Version](https://img.shields.io/badge/version-6.1-orange)
![Tech](https://img.shields.io/badge/Vue.js-3.0-green)
![UI](https://img.shields.io/badge/UI-Responsive-ff69b4)
![AI](https://img.shields.io/badge/Gemini-2.0-blue)
![Backend](https://img.shields.io/badge/Google_Apps_Script-BYOB-orange)
![Export](https://img.shields.io/badge/Excel-Dual_Header_Export-blue)

## 📖 專案概述 (Overview)
本系統為基於 Web 的單頁應用程式 (SPA)，旨在協助導師利用生成式 AI (Gemini)，將口語觀察紀錄轉化為教育專業評語。**V6.1 版本強化雙層表頭匯入、班級資訊編輯與生成逾時保護**，在手機、平板、電腦上都能穩定管理高達 40 個欄位的複雜學務資料，完美對接學校行政系統！

## ✨ V6.1 核心功能 (Features)

### 🎯 三大亮點

* **📑 分頁式操作介面 (Tabbed UI)**：
  * 引入「📝 評語生成」、「📊 行為量表」、「🏆 多元紀錄」三頁籤設計。
  * 在手機上也能輕鬆管理高達 40 個欄位的複雜資料，操作流暢不卡頓。
  * 每個 Tab 獨立運作，資料自動同步，無需手動切換儲存。

* **📊 行為量表矩陣 (Behavior Matrix)**：
  * 完整支援 5 大類行為指標評量：
    * **敬愛人**：友愛同學、接納多元、感謝服務、讚美學習、誠實改正
    * **愛整潔**：洗手潔牙、物歸定位、儀容整潔、垃圾不落地、正確如廁
    * **守秩序**：遵守排隊、不喧嘩奔跑、用餐秩序、按時到校、愛惜公物
    * **有禮貌**：主動問好、常說請謝謝、仔細聆聽、言行有禮、虛心受教
    * **做環保**：垃圾分類、資源回收、自備餐具、節約能源、愛物惜物
  * 每大類包含 5 個子題 + 1 個具體建議欄位，共 25 個評量項目。
  * **⚡ 便捷功能**：內建「一鍵預設」按鈕，秒速完成全班「大部分符合」的設定，僅需微調例外項目，大幅節省時間！

* **🎯 學務系統完美對接 (Perfect Sync)**：
  * 支援 **雙層表頭 (Multi-level Header)** Excel 匯出，格式包含「合併儲存格」。
  * 完全 100% 相容學校原始匯入檔，無需二次加工，直接上傳即可。
  * 自動產生符合規定的檔名，如 `日常行為表現與導師評語匯入檔(207).xlsx`。
  * 匯出欄位包含：基本資料、5 大類行為評量、多元表現紀錄、導師評語等完整資訊。

### 🌟 其他核心功能

* **⚖️ 雙重語氣引擎**：
  * **成績單評語**：維持 70-80 字的暖心、正向風格 (給家長)。
  * **八字箴言**：依據真實觀察，給予「兩好」、「一好一壞」或「兩壞」的中立嚴謹評價 (給校方)。

* **🛠️ 匯入與班級管理強化 (V6.1)**：
  * 支援 V6.0 雙層表頭 Excel 匯入，採索引對應解析，避免欄位錯置。
  * 班級卡片提供「✏️ 編輯」功能，可即時修正年級、班序與別名。

* **⏱️ 生成逾時保護 (V6.1)**：
  * 15 秒逾時自動切換模型，避免按鈕長時間卡在「思考中」。
  * 逾時與錯誤提示更清楚，生成流程更穩定。

* **☁️ 雲端同步**：一鍵將班級資料備份至 Google 雲端硬碟，跨裝置無縫接軌。

* **📱 RWD 響應式設計**：完美支援手機、平板、電腦，隨時隨地都能操作。

---

## ☁️ 雲端後端設定教學 (初次使用必讀)

若您希望啟用「跨裝置同步」功能，請先花 3 分鐘建立您專屬的雲端資料庫。
*(若僅需單機使用，可跳過此步驟)*

### 步驟 1：建立雲端資料庫
1. 開啟並登入 Google 帳號。
2. 建立一個新的 [Google 試算表](https://sheets.new)，命名為 `評語資料庫`。
3. 點選上方選單 **「擴充功能」** -> **「Apps Script」**。

### 步驟 2：部署後端程式
1. 清空編輯器中的程式碼。
2. 複製以下程式碼並貼上：
   ```javascript
   function doPost(e) {
     var lock = LockService.getScriptLock(); lock.tryLock(10000);
     try {
       SpreadsheetApp.getActive().getRange("A1").setValue(e.postData.contents);
       SpreadsheetApp.getActive().getRange("A2").setValue("最後更新: " + new Date());
       return ContentService.createTextOutput(JSON.stringify({'result':'success'})).setMimeType(ContentService.MimeType.JSON);
     } catch(e) { return ContentService.createTextOutput(JSON.stringify({'result':'error'})).setMimeType(ContentService.MimeType.JSON); }
     finally { lock.releaseLock(); }
   }
   function doGet(e) {
     var data = SpreadsheetApp.getActive().getRange("A1").getValue();
     return ContentService.createTextOutput(data || JSON.stringify({})).setMimeType(ContentService.MimeType.JSON);
   }
   ```

3. 點擊右上角 **「部署」** -> **「新增部署作業」**。
4. 點擊齒輪圖示 -> 選擇 **「網頁應用程式」**。
   * 說明：`貓貓後台`
   * 執行身分：**我 (Me)**
   * 誰可以存取：**所有人 (Anyone)** *(⚠️ 必要設定，讓評語助手能連線)*
5. 點擊 **「部署」** -> **「複製網頁應用程式網址」**。

### 步驟 3：連線同步
1. 回到評語助手網頁，點擊上方 **「☁️ 雲端同步」**。
2. 貼上剛剛複製的網址。
3. 點擊 **「上傳備份」** 測試，若出現綠色成功訊息即完成！

---

## 🚀 使用說明 (Usage Guide)

### 📋 三步驟工作流

#### Step 1: 建立與觀察 (Tab 1 - 📝 評語生成)
1. **建立班級**：
   * 點擊左上角的「🏡 貓窩管理」。
   * 在「建立新班級」區塊，輸入正確的 **年級** (如 4) 與 **班序** (如 7)。
   * 輸入學生人數，系統會自動產生座號。

2. **生成評語**：
   * 點選左側學生名單，輸入學生姓名與觀察紀錄。
   * 點擊「🐾 貓貓幫你寫」按鈕。
   * 系統會同時產生：
     * **✨ 暖心評語**：適合貼在成績單上 (70-80 字，溫暖正向)。
     * **⚖️ 嚴謹箴言**：適合用於學籍卡紀錄 (系統會自動判斷優缺點比例)。

#### Step 2: 行為評量 (Tab 2 - 📊 行為量表)
1. **切換頁籤**：
   * 點擊頂部「📊 行為量表」頁籤。

2. **一鍵預設 (省時神器！)**：
   * 點擊頂部的 **「⚡ 一鍵預設 (大部分符合)」** 按鈕。
   * 系統會自動將該學生所有 25 個行為指標填入「大部分符合」，秒速完成設定！

3. **個別微調**：
   * 針對個別項目進行調整 (例如某生經常遲到，僅需修改「守秩序」類別中的「按時到校」項目)。
   * 在各大類下方輸入具體建議 (選填，例如：「能主動協助同學整理教室，值得肯定」)。

#### Step 3: 多元紀錄 (Tab 3 - 🏆 多元紀錄)
1. **切換頁籤**：
   * 點擊頂部「🏆 多元紀錄」頁籤。

2. **輸入多元表現**：
   * **團體活動紀錄**：輸入校慶、校外教學、班級競賽等共同活動。
   * **公共服務紀錄**：
     * 校內服務：如擔任糾察隊、圖書小志工等。
     * 社區服務：如參與社區清潔、關懷長者等。
   * **特殊表現紀錄**：
     * 校內特殊表現：如參加校內比賽獲獎、擔任班級幹部等。
     * 校外特殊表現：如參加校外競賽、才藝表演等。

3. **匯出檔案**：
   * 完成所有資料輸入後，點擊右上角的 **「🐟 匯出 Excel」**。
   * 系統會下載格式完全符合學務系統要求的 Excel 檔 (含雙層表頭、合併儲存格，可直接上傳)。

---

本系統提供 **「線上版」** 與 **「單機版」** 兩種使用方式，請依您的需求選擇。

### 🌐 方法一：使用線上發佈版本 (GitHub Pages)
最推薦的方式！無需下載任何檔案，只要有網址即可使用。

1. **開啟網頁**：前往部署好的 GitHub Pages 網址（例如：`https://您的帳號.github.io/meow-comment-helper/`）。
2. **輸入金鑰**：
   * 首次進入時，畫面右上方會顯示紅色的 **「🚫 罐罐鑰匙 (未輸入)」**。
   * 請在該輸入框中貼上您的 **Google Gemini API Key**。
3. **設定雲端 (選用)**：
   * 點擊上方 **「☁️ 雲端同步」** 按鈕。
   * 貼上您在上方步驟取得的 **Google Script 網址 (GAS URL)**。
   * 點擊 **「上傳備份」** 測試連線。
4. **自動記憶**：
   * 系統會自動將 Key 與 URL 儲存在您的瀏覽器暫存區 (LocalStorage)。

### 💻 方法二：下載單機版 (Local Version)
適合希望在無網路環境整理資料（生成評語仍需網路），或希望進階管理設定的使用者。

#### 模式 A：快速使用 (無 Config 檔)
1. 點擊綠色的 `Code` 按鈕 -> `Download ZIP` 下載本專案。
2. 解壓縮後，直接雙擊 `index.html` 開啟。
3. 操作方式同線上版，直接在介面輸入 Key 與 URL 即可。

#### 模式 B：自動載入 (建立 Config 檔)
如果您希望將設定寫死在檔案中，避免誤刪快取後需要重填：
1. 在專案根目錄建立一個新檔案 `config.js`。
2. 填入以下內容並儲存：
   ```javascript
   window.APP_CONFIG = {
       GEMINI_API_KEY: "在此貼上您的_AIza_開頭金鑰",
       GAS_URL: "在此貼上您的_Google_Script_網址"
   };
   ```
3. 重新整理網頁，右上角即會顯示綠色的 「罐罐鑰匙 (OK)」，且輸入框會被鎖定。

---

## 📐 系統分析與設計 (System Analysis & Design)

### 1. 系統架構 (Architecture)
V6.1 採用 **Client-Serverless + BYOB (Bring Your Own Backend)** 架構。前端負責邏輯與生成，後端資料庫由使用者自行託管於 Google Sheets。

* **前端框架**：Vue.js 3 (Composition API)
* **樣式框架**：Tailwind CSS
* **資料處理**：SheetJS (xlsx)
* **資料儲存**：Browser LocalStorage + Google Sheets (Cloud)
* **通訊協定**：HTTPS (JSON Payload)

### 2. 資料結構 (Data Schema)
系統資料儲存於 LocalStorage 的 `gemini_comments_v4_db` 鍵值中，雲端同步時則將此物件完整轉為 JSON 字串存入試算表 A1 儲存格。

```json
{
  "activeClassId": "class_2026_302",
  "classes": {
    "class_id_xxxxxxxx": {
      "name": "114學年 302班",
      "grade": "4",
      "classNum": "7",
      "students": [
        {
          "id": "01",
          "name": "王小明",
          "raw_comment": "原始紀錄...",
          "polished_comment": "生成評語...",
          "motto": "八字箴言...",
          "behavior": {
            "敬愛人": {
              "items": ["大部分符合", "完全符合", "部分符合", "", ""],
              "suggestion": "具體建議..."
            },
            "愛整潔": { ... },
            "守秩序": { ... },
            "有禮貌": { ... },
            "做環保": { ... }
          },
          "records": {
            "groupActivity": "團體活動紀錄...",
            "publicServiceSchool": "校內服務...",
            "publicServiceCommunity": "社區服務...",
            "specialPerformanceSchool": "校內特殊表現...",
            "specialPerformanceExternal": "校外特殊表現..."
          }
        }
      ]
    }
  }
}
```

### 3. 功能需求 (Functional Requirements)
| ID | 模組 | 功能描述 |
| :--- | :--- | :--- |
| FR-01 | 系統核心 | 支援介面輸入或 Config 檔載入 API Key，具備狀態記憶功能 |
| FR-02 | 班級管理 | 支援新增、切換、刪除班級，包含年級與班序設定 |
| FR-03 | 雲端同步 | 支援將資料上傳/下載至使用者指定的 Google Sheet (V5.0 新增) |
| FR-04 | 內容生成 | 依據「三明治法」生成評語與箴言 (JSON Mode) |
| FR-05 | 行為量表 | 支援 5 大類共 25 個行為指標評量，內建一鍵預設功能 (V6.0 新增) |
| FR-06 | 多元紀錄 | 支援團體活動、公共服務、特殊表現等完整紀錄 (V6.0 新增) |
| FR-07 | 報表輸出 | 匯出包含雙層表頭、合併儲存格的 Excel，完美對接學務系統 (V6.0 升級) |
| FR-08 | 匯入解析 | 支援雙層表頭 Excel 匯入，採索引對應解析 (V6.1 新增) |
| FR-09 | 班級編輯 | 支援班級資訊編輯（年級、班序、別名）(V6.1 新增) |
| FR-10 | 逾時保護 | 生成流程加入 15 秒逾時保護與模型切換 (V6.1 新增) |

---

## 📝 版本歷程 (Changelog)

* **V6.1 (2026-01-15)**：**穩定性與匯入強化**
  * 升級 **匯入引擎**：支援 V6.0 雙層表頭 Excel 匯入，採索引定位解析，避免欄位錯置。
  * 新增 **班級編輯功能**：可於貓窩管理中編輯年級、班序與別名，修正匯入資料更方便。
  * 強化 **生成逾時控制**：15 秒逾時自動切換模型，避免卡在「思考中」。

* **V6.0 (2026-01-14)**：**重大改版 - 全能行政版**
  * 新增 **Tab 分頁介面**：引入「評語生成」、「行為量表」、「多元紀錄」三頁籤設計，在手機上也能輕鬆管理高達 40 個欄位的複雜資料。
  * 新增 **行為量表矩陣**：完整支援 5 大類（敬愛人、愛整潔、守秩序、有禮貌、做環保）共 25 個行為指標評量，內建「一鍵預設」功能。
  * 新增 **多元表現紀錄**：支援團體活動、公共服務（校內/社區）、特殊表現（校內/校外）等完整紀錄。
  * 升級 **Excel 匯出引擎**：支援「雙層表頭 (Multi-level Header)」與「合併儲存格」，完美對接學務系統，100% 相容原始匯入格式，無需二次加工。

* **V5.2 (2026-01-13)**：新增 RWD 響應式網頁設計，支援手機/平板介面，優化漢堡選單與操作動線。

* **V5.1**：新增校務系統匯入格式支援、雙重語氣生成引擎 (暖心/嚴謹)、精準班級設定。

* **V5.0**：新增 Google Sheets 雲端同步功能 (BYOB 架構)。

* **V4.0**：新增多班級管理、Excel 逆向匯入。

* **V3.0**：加入姓名綁定、八字箴言生成。

## 📄 版權說明 (License)
MIT License. 歡迎教育工作者自由使用與修改。
