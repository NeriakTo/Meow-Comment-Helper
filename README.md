# 🐱 喵嗚評語助手 (Meow Comment Helper) V7.4

> **靈活鎖定版 (Flexible Locking Edition)**
> 專為國小導師打造的療癒系評語工具——現在您可以完全掌控：標籤自己定、評語自己改、想重寫哪裡就鎖哪裡！

![Version](https://img.shields.io/badge/version-7.4-orange)
![Feature](https://img.shields.io/badge/Locking-Enabled-red)
![Feature](https://img.shields.io/badge/Tags-Customizable-pink)
![Security](https://img.shields.io/badge/Security-Hardened-blueviolet)
![Tech](https://img.shields.io/badge/Vue.js-3.0-green)
![UI](https://img.shields.io/badge/UI-Warm_Cat_Café-FFB74D)
![RWD](https://img.shields.io/badge/RWD-Mobile_First-blue)
![AI](https://img.shields.io/badge/Gemini-2.0-purple)
![Backend](https://img.shields.io/badge/Google_Apps_Script-BYOB-orange)
![Export](https://img.shields.io/badge/Excel-Dual_Header-success)

## 📖 專案概述 (Overview)

本系統為基於 Web 的單頁應用程式 (SPA)，旨在協助導師利用生成式 AI (Gemini)，將口語觀察紀錄轉化為教育專業評語。

**V7.4 靈活鎖定版** 帶來前所未有的 **掌控感**！您可以鎖定滿意的評語、只讓 AI 重寫箴言；可以自訂專屬標籤、讓金句庫跨裝置漫遊；更可以直接編輯任何欄位，因為 **最終修飾權永遠在老師手中**。這隻貓咪助手現在完全聽您的指揮！ 🔒

---

## 🔒 V7.4 內容鎖定與局部生成 (NEW!)

**想改哪裡，就改哪裡！**

這是 V7.4 的殺手級功能。當您對 AI 生成的某部分滿意、但想微調另一部分時，不用再擔心整份評語被覆蓋。

### 🎯 功能說明

| 功能 | 說明 |
|------|------|
| **🔒 鎖定按鈕** | 在「老師評語」與「學籍卡箴言」標題旁新增了 **鎖頭圖示**，點擊即可切換 |
| **🔓 未鎖定 (預設)** | AI 可自由生成並覆寫該欄位 |
| **🔒 已鎖定** | AI **無法覆寫**該欄位，您的心血受到保護 |

### ✨ 局部重繪 (Partial Generation)

這是鎖定機制的精髓：

> 覺得評語寫得很好，但箴言想重寫？

1. 點擊「老師評語」旁的 🔓 → 變成 🔒 (鎖定評語)
2. 確保「學籍卡箴言」旁是 🔓 (未鎖定)
3. 再次按下「🐾 幫我寫」
4. **AI 只會重新生成箴言**，評語完全不受影響！

反過來也行——鎖定箴言、只重寫評語。**想改哪裡就鎖哪裡**！

### 🛡️ 防誤刪保護

- 被鎖定的欄位會變成 **唯讀模式** (背景變灰)
- 視覺上清楚提示：紅色邊框 + 鎖頭圖示
- 即使手滑按到「幫我寫」，鎖定的內容也安然無恙

> 💡 **小技巧**：若兩個欄位都被鎖定，系統會提醒您「請先解鎖欲修改的欄位」，不會浪費 API 呼叫！

---

## 🏷️ 自定義快速標籤 (V7.4 整合)

**讓標籤成為您的專屬金句庫！**

每位老師都有自己習慣的用語和觀察角度。現在快速標籤區塊可以完全由您掌控。

### ⚙️ 如何使用

1. **進入編輯模式**：點擊「快速標籤」區塊右上角的 **⚙️ 編輯** 按鈕
2. **刪除標籤**：點擊任何不適用的標籤（紅色樣式），系統會詢問確認後移除
3. **新增標籤**：在輸入框中輸入您常用的金句，點擊 **+ 新增** 即可
4. **還原預設**：若想重來，點擊底部的 **↺ 還原預設標籤** 即可恢復出廠設定（僅影響當前領域）
5. **完成編輯**：點擊 **✓ 完成** 返回一般模式

### ☁️ 雲端漫遊

您的自定義標籤會自動存入資料庫，這意味著：

| 功能 | 說明 |
|------|------|
| **自動儲存** | 每次修改即時寫入 LocalStorage |
| **雲端同步** | 使用「☁️ 雲端同步」後，標籤庫隨您跨裝置移動 |
| **分領域管理** | 每個教學領域（導師、國語、數學...）都有獨立的標籤庫 |

> 💡 **小提醒**：還原預設只會影響當前選擇的「領域」，其他領域的自定義標籤不受影響喔！

---

## ✨ V7.4 介面與操作優化

### 📐 獨立操作列 (Action Bar)

V7.4 將「🐾 幫我寫」按鈕從輸入框內移至 **下方的獨立區域**：

| 改善項目 | 說明 |
|----------|------|
| **不再遮擋** | 徹底解決文字過長時按鈕擋住內容的問題 |
| **視覺層次** | 輸入區與操作區分離，版面更清爽 |
| **點擊舒適** | 按鈕位置固定，操作更順手 |

### ✏️ 欄位皆可編輯

- **老師評語**：可隨時手動修改、微調用詞
- **學籍卡箴言**：不再是唯讀，您可以直接輸入或修正
- **鎖定狀態**：鎖定後變成唯讀，解鎖即可編輯

### 🧠 AI 邏輯升級

我們重新調校了學籍卡箴言 (Motto) 的生成引擎：

- ✅ 若觀察紀錄包含負面行為，箴言會如實反映，不再文不對題
- ✅ 正面、中性、負面三種情境的輸出邏輯更加清晰
- ✅ 減少「明明有缺點卻只給讚美」的尷尬情況

> 🔒 技術細節保密：生成邏輯為系統內部優化，僅對輸出品質負責，不對外揭露。

---

## 🔒 V7.1 資安與隱私強化 (Security Features)

V7.1 新增四大防護機制，讓您安心使用：

### 💻 公用電腦模式 (Public Mode)

在輸入 API Key 時，可勾選「**💻 此為公用電腦 (不儲存金鑰)**」選項。

| 模式 | API Key 儲存位置 | 關閉視窗後 |
|------|------------------|------------|
| **一般模式** | 瀏覽器 LocalStorage | 保留，下次自動載入 |
| **公用模式** | 僅記憶體 (RAM) | 自動消失，需重新輸入 |

> 💡 適用情境：在學校公用電腦、圖書館電腦或借用他人設備時使用，確保離開後不留痕跡。

---

### 🗑️ 一鍵清除敏感資料 (Panic Button)

位於「☁️ 雲端同步」視窗底部的 **紅色按鈕**，可瞬間清除所有敏感憑證：

- ✅ 清除 API Key
- ✅ 清除 GAS 網址
- ✅ 清除通關密語
- ✅ 強制重新整理頁面
- ❌ **不會**清除班級資料 (放心！)

> 💡 適用情境：緊急情況下快速清除敏感資訊，或定期清理使用痕跡。

---

### 🔐 雲端通關密語 (GAS Secret Token)

雲端同步功能新增「**通關密語**」驗證機制：

1. 在「雲端同步」視窗輸入您的專屬密語 (預設: `meow1234`)
2. 同步時，密語會與資料一起傳送至 GAS 後端
3. 後端驗證密語正確才允許讀寫

```javascript
// GAS 後端驗證邏輯示意
if (payload.secret !== SECRET) {
    return { result: "error", message: "密語錯誤" };
}
```

> ⚠️ **重要**：請務必修改預設密語！在 GAS 程式碼中將 `var SECRET = "meow1234"` 改為您的專屬密語。

---

### 🛡️ Excel 匯出消毒 (Input Sanitization)

匯出 Excel 時，系統會自動檢測並處理特殊字元，防止 **公式注入攻擊 (Formula Injection)**：

| 原始輸入 | 消毒後輸出 | 說明 |
|----------|------------|------|
| `=SUM(A1:A10)` | `'=SUM(A1:A10)` | 加上前綴單引號 |
| `+886912345678` | `'+886912345678` | 防止被解析為公式 |
| `-100` | `'-100` | 防止減法運算 |
| `@mention` | `'@mention` | 防止 @ 觸發函式 |

> 💡 此防護機制可避免惡意使用者透過輸入特殊字元，在 Excel 開啟時執行非預期的公式或外部連結。

---

## ✨ V7.0 核心亮點 (延續)

### 🎨 全新視覺體驗 - 貓咪咖啡廳風格

| 設計元素 | 實作細節 |
|----------|----------|
| **字型** | 採用 `Varela Round` (圓潤標題) + `Noto Sans TC` (清晰內文) 雙字型組合 |
| **配色** | 米奶油色背景 `#FFF8F0`、拿鐵棕文字 `#5D4037`、淺橘主色 `#FFB74D` |
| **圓角** | 所有元件採用 `rounded-2xl` ~ `rounded-3xl` 超圓潤設計 |
| **動效** | 按鈕 hover 縮放、Tab 切換位移、淡入淡出轉場 |

> 💡 設計理念：減少冰冷的行政工具感，創造舒適的閱讀與操作環境，讓老師在繁忙的期末也能感受到一絲療癒。

---

### 🧙 新手引導精靈 (Welcome Wizard)

首次使用時，系統會自動彈出 **三步驟引導流程**，手把手教您完成設定：

1. **👋 歡迎頁**：親切的問候與功能簡介
2. **🥫 領取罐罐**：一鍵前往 Google AI Studio 申請免費 API Key
3. **✨ 餵食罐罐**：貼上 Key 即可啟動助手 (可勾選公用電腦模式)

> 💡 想再看一次教學？點擊頂部導覽列 API Key 旁的 **❓** 圓形按鈕即可重新開啟！

---

### ☁️ 內嵌雲端教學 (Embedded GAS Tutorial)

在「雲端同步」設定視窗中，我們提供 **摺疊式教學區塊**：

- 📋 **Step 1**：一鍵複製 GAS 程式碼 (已含驗證機制)
- 🆕 **Step 2**：前往 Google Apps Script 建立專案
- 🚀 **Step 3**：部署為網頁應用程式
- 🔗 **Step 4**：取得網址並貼回

> ⚠️ **V7.1 更新**：新版 GAS 程式碼已包含「通關密語」驗證邏輯，請記得：
> 1. 修改程式碼中的 `var SECRET = "meow1234"` 為您的專屬密語
> 2. 在「雲端同步」視窗填入相同的密語

---

### 📊 行為量表強化

| 優化項目 | 說明 |
|----------|------|
| **⚡ 一鍵預設按鈕** | 採用醒目的 **翠綠色** (`emerald-500`)，在橘色介面中成為明顯的「綠色通道」 |
| **📖 題目文字放大** | 從 `text-xs` 升級為 `text-[15px]`，搭配 `font-medium` 字重，大幅提升閱讀舒適度 |
| **📱 RWD 優化** | 手機版下拉選單全寬顯示、卡片間距縮減、高度自適應 |

---

### 📱 RWD 響應式設計升級

| 裝置 | 側邊欄 | 主內容區 | 圓角 |
|------|--------|----------|------|
| **手機版** | 85% 螢幕寬、僅右側圓角、滑入式動畫 | 全屏無邊距 | 減少圓角 |
| **桌面版** | 固定 320px、四邊留白、懸浮卡片 | 四邊留白、外框邊框 | 完整圓角 |

---

## 🌟 延續自 V6.x 的功能

### 📑 分頁式操作介面 (Tabbed UI)

- **📝 評語生成**：AI 雙語氣引擎，產出暖心評語 + 嚴謹箴言
- **📊 行為量表**：5 大類 25 項指標，內建一鍵預設
- **🏆 多元紀錄**：團體活動、公共服務、特殊表現完整記錄

### 🎯 學務系統完美對接

- **雙層表頭匯出**：含合併儲存格，100% 相容學校匯入格式
- **雙層表頭匯入**：索引定位解析，自動偵測年級班序
- **班級編輯功能**：可隨時修正年級、班序與別名

### ⏱️ 穩定性保障

- **15 秒逾時保護**：自動切換備用模型，避免卡住
- **LocalStorage 自動儲存**：深度監聽，輸入即存
- **雲端同步**：一鍵備份至 Google Sheets (含密語驗證)

---

## 🚀 快速開始 (Quick Start)

### 🌐 線上版 (推薦)

1. 開啟 GitHub Pages 網址
2. 跟隨 **新手引導精靈** 完成 API Key 設定
3. 點擊左上角「🏡 貓窩管理」建立班級
4. 選擇學生、輸入觀察紀錄、點擊「🐾 幫我寫」

### 💻 單機版

1. 下載 ZIP 並解壓縮
2. 雙擊 `index.html` 開啟
3. 操作同線上版

### ⚙️ 進階設定 (Config 檔)

建立 `config.js` 並填入：

```javascript
window.APP_CONFIG = {
    GEMINI_API_KEY: "您的_AIza_開頭金鑰",
    GAS_URL: "您的_Google_Script_網址"
};
```

---

## 📋 三步驟工作流 (Workflow)

### Step 1: 建立與觀察 (Tab 1 - 📝 評語生成)

1. 點擊「🏡 貓窩管理」建立班級（輸入年級、班序、人數）
2. 選擇學生，輸入姓名與觀察紀錄
3. 點擊「🐾 幫我寫」生成評語
4. **NEW!** 若滿意評語但想改箴言，點擊 🔓 鎖定評語後再按一次「幫我寫」

### Step 2: 行為評量 (Tab 2 - 📊 行為量表)

1. 切換至「📊 行為量表」頁籤
2. 點擊 **⚡ 一鍵預設** 快速填入「大部分符合」
3. 針對例外項目微調，輸入具體建議

### Step 3: 多元紀錄 (Tab 3 - 🏆 多元紀錄)

1. 切換至「🏆 多元紀錄」頁籤
2. 輸入團體活動、公共服務、特殊表現
3. 點擊右上角 **📥 匯出** 下載 Excel

---

## 📐 技術架構 (Architecture)

| 層級 | 技術 |
|------|------|
| **前端框架** | Vue.js 3 (Composition API) |
| **樣式框架** | Tailwind CSS |
| **字型** | Google Fonts (Varela Round, Noto Sans TC) |
| **資料處理** | SheetJS (xlsx) |
| **本地儲存** | Browser LocalStorage |
| **雲端儲存** | Google Sheets (BYOB 架構) |
| **AI 引擎** | Google Gemini API |
| **資安防護** | Formula Injection 消毒、GAS Token 驗證、公用模式 |

---

## 📝 版本歷程 (Changelog)

### V7.4 (2026-01-16) - 靈活鎖定版 🔒

**🔒 內容鎖定**
- 新增欄位 **鎖定功能**：在「老師評語」與「學籍卡箴言」標題旁新增 🔒/🔓 切換按鈕
- 支援 **局部生成**：鎖定滿意的欄位，AI 只會重新生成未鎖定的部分
- 鎖定後欄位變成 **唯讀模式**，視覺上以紅色邊框 + 灰色背景提示

**📐 UI 優化**
- 新增底部 **獨立操作列 (Action Bar)**：「🐾 幫我寫」按鈕不再遮擋文字內容
- 優化輸入框與操作區的視覺層次與間距

**🏷️ 自定義標籤**
- 開放標籤 **編輯模式**：點擊「⚙️ 編輯」即可進入
- 支援 **新增** 常用金句、**刪除** 不適用標籤、**一鍵還原** 預設
- 自定義標籤隨 **雲端同步** 跨裝置漫遊

**🧠 AI 邏輯升級**
- 優化八字箴言生成引擎，精準判斷正負向屬性 (Re-aligned Logic)
- 減少「文不對題」的正向箴言誤判情況

**✏️ UX 改進**
- 評語欄位、箴言欄位皆開放 **手動編輯**
- 移除繁瑣的覆蓋確認視窗，改用 **鎖定機制** 取代 (更直覺！)

---

### V7.1 (2026-01-16) - 資安與隱私強化版 🔒

**🔐 隱私防護**
- 新增「**公用電腦模式**」，支援 API Key 不落地使用，關閉視窗即焚
- 新增頂部工具列「💻 公用」快速勾選 (桌面版)

**🗑️ 緊急清除**
- 新增「**Panic Button**」，一鍵清除 API Key、GAS 網址、通關密語
- 位於雲端同步視窗底部，紅色醒目按鈕

**🔐 後端加固**
- GAS 雲端同步新增「**通關密語**」驗證機制
- 前端傳送 `{ secret, data }` 結構，後端驗證後才允許讀寫
- 內嵌教學程式碼已更新為含驗證版本

**🛡️ 匯出防護**
- 實作 Excel 匯出字串消毒 (`sanitizeForExcel`)
- 自動處理 `=`, `+`, `-`, `@` 開頭字串，防範公式注入攻擊

---

### V7.0 (2026-01-15) - 暖心貓咪版 🐱

**🎨 視覺大改版**
- 全新「貓咪咖啡廳」風格，採用暖色調配色與超圓角設計
- 引入 `Varela Round` + `Noto Sans TC` 雙字型組合
- 所有元件升級為 `rounded-2xl` ~ `rounded-3xl` 圓潤設計

**🧙 新手引導強化**
- 新增 **三步驟引導精靈**：歡迎 → 領取 Key → 輸入 Key
- 新增頂部 **❓ 教學按鈕**，可隨時重新開啟引導
- 新增雲端同步 **內嵌 GAS 教學**，一站式完成後端部署

**📊 行為量表優化**
- 「一鍵預設」按鈕改為 **翠綠色**，視覺更突出
- 題目文字放大至 `15px` + `font-medium`，閱讀更舒適

**📱 RWD 全面升級**
- 手機版側邊欄改為 85% 螢幕寬、僅右側圓角
- 手機版主內容區全屏顯示，無外邊距
- 頂部工具列、Tab 按鈕、輸入框全面優化手機版尺寸

---

### V6.1 (2026-01-15) - 穩定性與匯入強化

- 升級匯入引擎：支援 V6.0 雙層表頭 Excel 匯入
- 新增班級編輯功能：可於貓窩管理中編輯年級、班序與別名
- 強化生成逾時控制：15 秒逾時自動切換模型

### V6.0 (2026-01-14) - 全能行政版

- 新增 Tab 分頁介面：評語生成、行為量表、多元紀錄
- 新增行為量表矩陣：5 大類 25 項指標，內建一鍵預設
- 升級 Excel 匯出引擎：支援雙層表頭與合併儲存格

### V5.x

- V5.2：新增 RWD 響應式設計
- V5.1：新增校務系統匯入格式支援、雙重語氣引擎
- V5.0：新增 Google Sheets 雲端同步 (BYOB 架構)

### V4.0 及更早

- V4.0：多班級管理、Excel 逆向匯入
- V3.0：姓名綁定、八字箴言生成

---

## 📄 版權說明 (License)

MIT License. 歡迎教育工作者自由使用與修改。

---

<p align="center">
  <strong>🐾 喵嗚評語助手 - 溫暖、安全、完全由您掌控，讓期末評語變得輕鬆療癒 🐾</strong>
</p>
